# Copyright (c) 2023 EPAM Systems, Inc.
#
# This Source Code Form is subject to the terms of the Mozilla Public
# License, v. 2.0. If a copy of the MPL was not distributed with this
# file, You can obtain one at http://mozilla.org/MPL/2.0/.

policies:
  - name: ecc-aws-294-elastic_beanstalk_notifications_enabled
    comment: '010032032000'
    description: |
      Elastic Beanstalk environments notifications disabled
    resource: aws.elasticbeanstalk-environment
    filters:
    - type: value
      key: Status
      op: ne
      value: Terminated
    - or:
      - type: configuration-settings
        attrs:
          - OptionName: Notification Endpoint
          - Value: null
      - and:
        - or:
          - type: configuration-settings
            attrs:
              - OptionName: Notification Protocol
              - Value: email
          - type: configuration-settings
            attrs:
              - OptionName: Notification Protocol
              - Value: email-json
        - type: configuration-settings
          attrs:
            - type: value
              key:  OptionName
              value: Notification Topic ARN
            - type: value
              key:  Value
              value: not-null
        - type: related
          ids: "\"c7n:OptionSettings\"[?OptionName=='Notification Topic ARN'].Value[]"
          annotation: "c7n:sns"
          policy:
            resource: aws.sns
            filters:
              - type: value
                key: SubscriptionsConfirmed
                op: eq
                value: "0"

